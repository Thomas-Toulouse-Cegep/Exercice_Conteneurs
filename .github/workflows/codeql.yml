name: CodeQL Analysis

on:
  push:
    branches: [main]

jobs:
  analyze:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    # Initialize the CodeQL environment
    - name: Initialize CodeQL
      uses: github/codeql-action/init@v1
      with:
        languages: cpp

    # Compile the project with Visual Studio
    - name: Build
      run: |
        "C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Auxiliary\Build\vcvarsall.bat" x64
        msbuild /p:Configuration=Release

    # Analyze the project with CodeQL
    - name: Analyze
      uses: github/codeql-action/analyze@v1
      with:
        # Point CodeQL to the compiled project files
        # You may need to adjust the paths and file extensions depending on your project structure
        # In this example, we assume the project is built in the 'build' directory
        # with a .pdb debug symbol file for each compiled binary
        # For more information, see: https://help.semmle.com/codeql/codeql-cli/reference/command-reference/ql-analyze/#--search-pathdir
        search-path: build/
        # Point CodeQL to the C++ standard library source files
        # This is optional, but recommended to improve the accuracy of the analysis
        # You may need to adjust the paths depending on your system configuration
        # For more information, see: https://help.semmle.com/codeql/codeql-cli/reference/command-reference/ql-analyze/#--search-pathdir
        library-path: 'C:\Program Files (x86)\Microsoft Visual Studio\2019\Community\VC\Tools\MSVC\14.29.30133\include'

    # Upload the analysis results to CodeQL
    - name: Upload SARIF
      uses: github/codeql-action/upload-sarif@v1
      with:
        # Point CodeQL to the SARIF file generated by the analysis
        # In this example, we assume the SARIF file is named 'codeql.sarif' and located in the 'build' directory
        # You may need to adjust the path and file name depending on your project structure
        # For more information, see: https://help.semmle.com/codeql/codeql-cli/reference/command-reference/ql-convert/#--outputdirdir
        sarif_file: build/codeql.sarif
